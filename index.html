<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Buddy - AI Learning Platform</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; }
        .glass-card { backdrop-filter: blur(20px); background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); }
        .glass-btn { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); cursor: pointer; }
        .glass-btn:hover { transform: scale(1.01); box-shadow: 0 10px 30px rgba(0,122,255,0.3); }
        .glass-btn:active { transform: scale(0.98); }
    </style>
</head>
<body class="bg-black text-white">
    <div id="root"></div>
    <script type="text/babel">
        const { createClient } = supabase;
        const supabaseUrl = 'https://tmjsxhvpqwynbfqxzuek.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRtanN4aHZwcXd5bmJmcXh6dWVrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzAyNDczMDcsImV4cCI6MjA0NTgyMzMwN30.Zr5_f_hcBEbVLLSNQ_pKPbsVGH4-_yNLMuHzvC3YYRo';
        const db = createClient(supabaseUrl, supabaseKey);

        const APP = () => {
            const [user, setUser] = React.useState(null);
            const [loading, setLoading] = React.useState(true);
            const [currentPage, setCurrentPage] = React.useState('home');
            const [sets, setSets] = React.useState([]);
            const [newSetName, setNewSetName] = React.useState('');
            const [stats, setStats] = React.useState({ sets: 0, cards: 0, accuracy: 87 });

            React.useEffect(() => {
                initializeGoogle();
                checkAuth();
            }, []);

            const initializeGoogle = () => {
                window.google.accounts.id.initialize({
                    client_id: '970988128380-9p9f5q5q5q5q5q5q5q5q5q5q5q5q5q5q.apps.googleusercontent.com',
                    callback: handleCredentialResponse
                });
                window.google.accounts.id.renderButton(
                    document.getElementById('google-signin-button'),
                    { theme: 'dark', size: 'large' }
                );
            };

            const handleCredentialResponse = async (response) => {
                const token = response.credential;
                const decoded = JSON.parse(atob(token.split('.')[1]));
                const userData = { email: decoded.email, name: decoded.name, picture: decoded.picture };
                
                // Save to localStorage for demo
                localStorage.setItem('user', JSON.stringify(userData));
                setUser(userData);
                setLoading(false);
                
                // Try to save to Supabase
                try {
                    await db.from('users').upsert({ email: userData.email, name: userData.name }, { onConflict: 'email' });
                } catch (e) {
                    console.log('Supabase connection demo mode - using localStorage');
                }
            };

            const checkAuth = () => {
                const savedUser = localStorage.getItem('user');
                if (savedUser) {
                    setUser(JSON.parse(savedUser));
                }
                setLoading(false);
            };

            const handleLogout = () => {
                localStorage.removeItem('user');
                setUser(null);
            };

            const createSet = async () => {
                if (!newSetName.trim()) return;
                const newSet = { id: Date.now(), name: newSetName, cards: [], created: new Date() };
                const updatedSets = [...sets, newSet];
                setSets(updatedSets);
                localStorage.setItem('sets', JSON.stringify(updatedSets));
                setNewSetName('');
                setStats({ ...stats, sets: stats.sets + 1 });
            };

            const addCardToSet = (setId, front, back) => {
                const updatedSets = sets.map(s => {
                    if (s.id === setId) {
                        return { ...s, cards: [...s.cards, { id: Date.now(), front, back }] };
                    }
                    return s;
                });
                setSets(updatedSets);
                localStorage.setItem('sets', JSON.stringify(updatedSets));
                setStats({ ...stats, cards: stats.cards + 1 });
            };

            if (loading) return <div className="h-screen flex items-center justify-center"><div className="text-2xl">Loading...</div></div>;

            if (!user) {
                return (
                    <div className="h-screen flex flex-col items-center justify-center gap-8">
                        <h1 className="text-5xl font-bold">Welcome to Study Buddy</h1>
                        <p className="text-xl text-gray-400">Sign in with Google to start learning</p>
                        <div id="google-signin-button"></div>
                    </div>
                );
            }

            return (
                <div className="flex h-screen">
                    <nav className="w-64 glass-card border-r border-blue-500/20 p-6 overflow-y-auto">
                        <div className="flex items-center gap-3 mb-8">
                            <img src={user.picture} className="w-10 h-10 rounded-full" />
                            <div className="flex-1">
                                <p className="font-bold text-sm">{user.name}</p>
                                <p className="text-xs text-gray-400">{user.email}</p>
                            </div>
                        </div>
                        <div className="space-y-2 mb-8">
                            {['home', 'sets', 'flashcards', 'arcade', 'chat'].map(page => (
                                <button key={page} onClick={() => setCurrentPage(page)} className={`w-full text-left px-4 py-2 rounded-lg glass-btn ${currentPage === page ? 'bg-blue-500/30' : 'hover:bg-white/5'}`}>
                                    {page === 'home' && 'üè† Home'}
                                    {page === 'sets' && 'üìö My Sets'}
                                    {page === 'flashcards' && 'üéØ Flashcards'}
                                    {page === 'arcade' && 'üéÆ Arcade'}
                                    {page === 'chat' && 'ü§ñ AI Tutor'}
                                </button>
                            ))}
                        </div>
                        <button onClick={handleLogout} className="w-full px-4 py-2 bg-red-600 rounded-lg glass-btn text-white">Sign Out</button>
                    </nav>
                    <main className="flex-1 overflow-auto p-8">
                        {currentPage === 'home' && (
                            <div>
                                <h1 className="text-4xl font-bold mb-8">Welcome, {user.name}! üéì</h1>
                                <div className="grid grid-cols-3 gap-4">
                                    <div className="glass-card p-6 rounded-xl">
                                        <div className="text-3xl font-bold text-blue-400">{sets.length}</div>
                                        <div className="text-gray-400">Study Sets</div>
                                    </div>
                                    <div className="glass-card p-6 rounded-xl">
                                        <div className="text-3xl font-bold text-green-400">{sets.reduce((sum, s) => sum + s.cards.length, 0)}</div>
                                        <div className="text-gray-400">Total Cards</div>
                                    </div>
                                    <div className="glass-card p-6 rounded-xl">
                                        <div className="text-3xl font-bold text-purple-400">{stats.accuracy}%</div>
                                        <div className="text-gray-400">Accuracy</div>
                                    </div>
                                </div>
                            </div>
                        )}
                        {currentPage === 'sets' && (
                            <div>
                                <h1 className="text-4xl font-bold mb-8">My Study Sets</h1>
                                <div className="flex gap-4 mb-8">
                                    <input type="text" value={newSetName} onChange={(e) => setNewSetName(e.target.value)} placeholder="Set name..." className="flex-1 px-4 py-2 bg-white/10 rounded-lg border border-blue-500/20 focus:outline-none focus:border-blue-500" />
                                    <button onClick={createSet} className="px-6 py-2 bg-blue-600 rounded-lg glass-btn">Create Set</button>
                                </div>
                                <div className="grid grid-cols-2 gap-4">
                                    {sets.map(set => (
                                        <div key={set.id} className="glass-card p-6 rounded-xl cursor-pointer glass-btn">
                                            <h3 className="font-bold text-lg">{set.name}</h3>
                                            <p className="text-gray-400 text-sm mt-2">{set.cards.length} cards</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {currentPage === 'flashcards' && (
                            <div>
                                <h1 className="text-4xl font-bold mb-8">üéØ Flashcards Study Mode</h1>
                                <div className="glass-card p-8 rounded-xl text-center">
                                    <p className="text-lg text-gray-400 mb-4">Create a study set first!</p>
                                    <p className="text-gray-500">Add flashcards from the "My Sets" section to start studying.</p>
                                </div>
                            </div>
                        )}
                        {currentPage === 'arcade' && (
                            <div>
                                <h1 className="text-4xl font-bold mb-8">üéÆ Arcade Games</h1>
                                <div className="grid grid-cols-2 gap-4">
                                    {[{ name: 'Quiz Rush', icon: '‚ö°' }, { name: 'Memory Match', icon: 'üíé' }, { name: 'Word Blitz', icon: 'üí®' }, { name: 'Study Shooter', icon: 'üéØ' }].map((g) => (
                                        <div key={g.name} className="glass-card p-6 rounded-xl cursor-pointer glass-btn">
                                            <div className="text-5xl mb-2">{g.icon}</div>
                                            <h3 className="font-bold">{g.name}</h3>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        {currentPage === 'chat' && (
                            <div>
                                <h1 className="text-4xl font-bold mb-8">ü§ñ AI Tutor Chat</h1>
                                <div className="glass-card p-6 rounded-xl">
                                    <div className="h-96 mb-4 flex items-center justify-center text-gray-400">Chat interface coming soon...</div>
                                    <input type="text" placeholder="Ask me anything..." className="w-full px-4 py-2 bg-white/10 rounded-lg border border-blue-500/20 focus:outline-none focus:border-blue-500" />
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<APP />);
    </script>
</body>
</html>
